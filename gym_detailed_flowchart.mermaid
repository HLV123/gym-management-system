flowchart TD
    %% System Initialization
    A[ðŸš€ Start Gym System] --> B[ðŸ’¾ Load Data]
    B --> C{Data File Exists?}
    C -->|Yes| D[ðŸ“‚ Load gym_data.json]
    C -->|No| E[ðŸŽ² Create Sample Data]
    
    %% Sample Data Creation
    E --> E1[ðŸ‘‘ Create 1 Admin]
    E --> E2[ðŸƒâ€â™‚ï¸ Create 3 Trainers]
    E --> E3[ðŸ‘¥ Create 10 Members]
    E --> E4[ðŸ“¦ Create 4 Packages]
    E --> E5[ðŸ‹ï¸â€â™‚ï¸ Create 10 Equipment]
    E --> E6[ðŸ“… Create 15 Schedules]
    
    %% Login Flow
    D --> F[ðŸ”‘ Show Login Menu]
    E1 --> F
    E2 --> F
    E3 --> F
    E4 --> F
    E5 --> F
    E6 --> F
    
    F --> G[ðŸ“‹ Display 13 Users]
    G --> H{Select User}
    
    %% User Authentication
    H --> I[1. Admin - Nguyá»…n VÄƒn Quáº£n]
    H --> J[2. Trainer - Tráº§n Thá»‹ HÆ°Æ¡ng]
    H --> K[3. Trainer - LÃª VÄƒn Máº¡nh]
    H --> L[4. Trainer - Pháº¡m Minh Tuáº¥n]
    H --> M[5-13. Members 001-010]
    H --> N[14. Exit System]
    
    %% Role Assignment
    I --> O[ðŸ”’ Set Role: Admin]
    J --> P[ðŸ”’ Set Role: Trainer]
    K --> P
    L --> P
    M --> Q[ðŸ”’ Set Role: Member]
    
    %% Admin Dashboard
    O --> R[ðŸ“Š Admin Dashboard]
    R --> S{Admin Menu}
    S --> S1[ðŸ‘¥ Manage Members]
    S --> S2[ðŸƒâ€â™‚ï¸ Manage Trainers]
    S --> S3[ðŸ‹ï¸â€â™‚ï¸ Manage Equipment]
    S --> S4[ðŸ”— Assign Trainers]
    S --> S5[ðŸ’° Revenue Report]
    S --> S6[ðŸ“Š Attendance Report]
    S --> S7[ðŸ“ˆ Statistics]
    S --> S8[ðŸ“¤ Export CSV]
    S --> S9[ðŸšª Logout]
    
    %% Member Management Flow
    S1 --> S1A{Member Operations}
    S1A --> S1A1[âž• Add Member]
    S1A --> S1A2[âŒ Remove Member]
    S1A --> S1A3[ðŸ“‹ List Members]
    S1A --> S1A4[ðŸ”„ Renew Membership]
    
    S1A1 --> S1A1A[ðŸ“ Enter Info]
    S1A1A --> S1A1B[ðŸ“¦ Select Package]
    S1A1B --> S1A1C[ðŸ“… Calculate Dates]
    S1A1C --> S1A1D[ðŸ’¾ Save Member]
    
    %% Trainer Dashboard
    P --> T[ðŸ“Š Trainer Dashboard]
    T --> U{Trainer Menu}
    U --> U1[ðŸ‘¥ View Assigned Members]
    U --> U2[ðŸ“… Create Schedule]
    U --> U3[âœ… Mark Attendance]
    U --> U4[ðŸ“ˆ Update Progress]
    U --> U5[ðŸ”§ Update Equipment]
    U --> U6[ðŸ“Š Attendance Report]
    U --> U7[ðŸ“¤ Export Data]
    U --> U8[ðŸšª Logout]
    
    %% Permission Check for Trainer
    U2 --> U2A{Member Assigned?}
    U2A -->|Yes| U2B[âœ… Create Schedule]
    U2A -->|No| U2C[âŒ Access Denied]
    
    U3 --> U3A{Member Assigned?}
    U3A -->|Yes| U3B[âœ… Mark Attendance]
    U3A -->|No| U3C[âŒ Access Denied]
    
    %% Member Dashboard
    Q --> V[ðŸ“Š Member Dashboard]
    V --> W{Member Menu}
    W --> W1[ðŸ‘¤ Personal Info]
    W --> W2[ðŸ“… My Schedule]
    W --> W3[ðŸ“ˆ Update Progress]
    W --> W4[ðŸ”„ Renew Package]
    W --> W5[ðŸ“Š My Attendance]
    W --> W6[ðŸšª Logout]
    
    %% Membership Status Check
    W1 --> W1A[ðŸ“Š Check Status]
    W1A --> W1B{Days Left}
    W1B -->|>30| W1C[âœ… Active]
    W1B -->|7-30| W1D[âš ï¸ Expiring]
    W1B -->|<7| W1E[ðŸš¨ Urgent]
    W1B -->|0| W1F[âŒ Expired]
    
    %% Reports Generation
    S5 --> X[ðŸ’° Calculate Revenue]
    X --> X1[ðŸ“Š Total: 14,700,000 VND]
    X1 --> X2[ðŸ“¦ By Package Analysis]
    
    S6 --> Y[ðŸ“… Attendance Analysis]
    Y --> Y1[ðŸ“Š Calculate Percentages]
    Y1 --> Y2[ðŸ† Rank Members]
    
    %% Data Persistence
    S1A1D --> Z[ðŸ’¾ Save to JSON]
    U2B --> Z
    U3B --> Z
    W3 --> Z
    W4 --> Z
    
    %% Logout Flow
    S9 --> AA[ðŸ”“ Clear Session]
    U8 --> AA
    W6 --> AA
    AA --> BB[ðŸ’¾ Auto Save]
    BB --> F
    
    %% Exit Flow
    N --> CC[ðŸ’¾ Final Save]
    CC --> DD[ðŸ‘‹ Goodbye]
    
    %% Loop Back
    Z --> EE[ðŸ”„ Return to Menu]
    EE --> R
    EE --> T
    EE --> V
    
    %% Styling
    classDef startEnd fill:#e74c3c,stroke:#c0392b,stroke-width:3px,color:#fff
    classDef process fill:#27ae60,stroke:#229954,stroke-width:2px,color:#fff
    classDef decision fill:#f39c12,stroke:#e67e22,stroke-width:2px,color:#000
    classDef admin fill:#3498db,stroke:#2980b9,stroke-width:2px,color:#fff
    classDef trainer fill:#9b59b6,stroke:#8e44ad,stroke-width:2px,color:#fff
    classDef member fill:#1abc9c,stroke:#16a085,stroke-width:2px,color:#fff
    classDef data fill:#e67e22,stroke:#d35400,stroke-width:2px,color:#fff
    
    class A,DD startEnd
    class B,D,E1,E2,E3,E4,E5,E6,F,G,S1A1A,S1A1B,S1A1C,S1A1D,U2B,U3B,X,X1,X2,Y,Y1,Y2,Z,AA,BB,CC,EE process
    class C,H,S,S1A,U,U2A,U3A,W,W1B decision
    class I,O,R,S1,S2,S3,S4,S5,S6,S7,S8,S9,S1A1,S1A2,S1A3,S1A4 admin
    class J,K,L,P,T,U1,U2,U3,U4,U5,U6,U7,U8,U2C,U3C trainer
    class M,Q,V,W1,W2,W3,W4,W5,W6,W1A,W1C,W1D,W1E,W1F member
    class N,EE data